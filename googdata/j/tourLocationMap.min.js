function InitializeMap(b,d){var a;var f=new Boolean();var c=b.split("-");var e=c[1];var g=c[3];b=b+"-content";$.getJSON("http://tables.googlelabs.com/api/query?sql=SELECT * FROM 840293 WHERE fkTour = "+e+" AND pkLocation = "+g+" LIMIT 1&jsonCallback=?",function(j){tlLatLng=new google.maps.LatLng(j.table.rows[0][9],j.table.rows[0][10]);tlName=j.table.rows[0][2];tlAddress=j.table.rows[0][8];tlStopNum=j.table.rows[0][1];var h={zoom:15,mapTypeControl:false,streetViewControl:false,panControl:false,zoomControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP};var l;if(d=="map"){l=document.getElementById(b)}else{l=document.getElementById(b+"-novis")}var i=new google.maps.Map(l,h);if(navigator.geolocation){f=true;navigator.geolocation.getCurrentPosition(function(r){a=new google.maps.LatLng(r.coords.latitude,r.coords.longitude);i.setCenter(tlLatLng);var s=new google.maps.Marker({icon:"http://wsnet.uchicago.edu/prototype/googdata/i/here.png",position:a,map:i,title:"You are here.",visible:true});var t=new google.maps.InfoWindow({content:"You are here"});google.maps.event.addListener(s,"click",function(){t.open(i,s)});var u=new google.maps.Marker({icon:"http://wsnet.uchicago.edu/prototype/googdata/i/"+tlStopNum+".png",position:tlLatLng,map:i,title:tlName,visible:true});var o=new google.maps.InfoWindow({content:tlName});google.maps.event.addListener(u,"click",function(){o.open(i,u)});var n;var v=new google.maps.DirectionsService();var w={suppressMarkers:true,preserveViewport:true};directionsDisplay=new google.maps.DirectionsRenderer(w);if(d=="map"){directionsDisplay.setMap(i);var p=tlLatLng}else{directionsDisplay.setPanel(document.getElementById(b));var p=tlAddress}var m=a;var q={origin:m,destination:p,travelMode:google.maps.DirectionsTravelMode.WALKING};v.route(q,function(x,y){if(y==google.maps.DirectionsStatus.OK){directionsDisplay.setDirections(x)}})},function(){k(f)})}else{f=false;k(f)}function k(n){if(n==true){alert("Geolocation service failed.")}else{alert("Your browser does not support geolocation.")}a=tlLatLng;var o=new google.maps.Marker({position:tlLatLng,map:i,title:tlName});var m=new google.maps.InfoWindow({content:tlName});m.open(i,o);i.setCenter(a)}})}$(".mappage").live("pageshow",function(a,b){InitializeMap($(this).attr("id"),"map")});$(".directionspage").live("pageshow",function(a,b){InitializeMap($(this).attr("id"),"panel")});